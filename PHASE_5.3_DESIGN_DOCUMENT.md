# ğŸ“Š Ù…Ø±Ø­Ù„Ù‡ 5.3: ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙØ§Ú©ØªÙˆØ±

## ğŸ¯ Ù‡Ø¯Ù Ù…Ø±Ø­Ù„Ù‡
Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„ØªØ±ØŒ Ø¬Ø³ØªØ¬Ùˆ Ùˆ ØµØ§Ø¯Ø±Ø§Øª

## ğŸ“‹ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ

### 1. ØµÙØ­Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
- Ù†Ù…Ø§ÛŒØ´ timeline Ú©Ø§Ù…Ù„ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
- Ø³ÙˆØ±Øª Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
- Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù‡Ù…
- Pagination Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±
- Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ§Ú©ØªÙˆØ± (Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡/Ù…Ø¹Ù„Ù‚)

### 2. Ø³ÛŒØ³ØªÙ… ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡
- ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®ÛŒ (Ø´Ù…Ø³ÛŒ): Ø§Ø²/ØªØ§
- ÙÛŒÙ„ØªØ± Ù…Ø¨Ù„Øº: Ø­Ø¯Ø§Ù‚Ù„/Ø­Ø¯Ø§Ú©Ø«Ø±
- ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡
- ÙÛŒÙ„ØªØ± ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- Reset Ùˆ Clear Ù‡Ù…Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§

### 3. Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
- Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±
- Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù†Ø§Ù… Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡
- Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª
- Auto-complete Ø¨Ø±Ø§ÛŒ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡

### 4. Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡ÛŒ
- Ø§Ù†ØªØ®Ø§Ø¨ Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
- ØµØ§Ø¯Ø±Ø§Øª Excel Ú¯Ø±ÙˆÙ‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
- ØµØ§Ø¯Ø±Ø§Øª PDF Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
- Ø§Ø±Ø³Ø§Ù„ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ

### 5. Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª ÙØ§Ú©ØªÙˆØ±
- Modal Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„
- Ø¯Ø§Ù†Ù„ÙˆØ¯ PNG ÙØ§Ú©ØªÙˆØ±
- ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª ÙØ§Ú©ØªÙˆØ±
- ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØºÛŒÛŒØ±Ø§Øª ÙØ§Ú©ØªÙˆØ±

## ğŸ”§ Ø¬Ø²Ø¦ÛŒØ§Øª ÙÙ†ÛŒ

### Database Schema Updates
```sql
-- Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¯Ø± schema - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¬Ø¯Ø§ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯:
-- invoices, invoiceDetails, representatives, payments
```

### API Endpoints Ø¬Ø¯ÛŒØ¯
```typescript
// History & Filter APIs
GET /api/invoices/history?page=1&limit=20&dateFrom=&dateTo=&minAmount=&maxAmount=&representative=&status=
GET /api/invoices/search?q=query&type=invoice|representative|description
GET /api/invoices/export?ids=1,2,3&format=excel|pdf
GET /api/invoices/stats/monthly // Ø¢Ù…Ø§Ø± Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ø±Øª
```

### Frontend Components Ø¬Ø¯ÛŒØ¯
```typescript
// InvoiceHistoryPage.tsx - ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
// InvoiceFilters.tsx - Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª ÙÛŒÙ„ØªØ±Ù‡Ø§  
// InvoiceCard.tsx - Ú©Ø§Ø±Øª Ù†Ù…Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ±
// InvoiceSearch.tsx - Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
// BulkActions.tsx - Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡ÛŒ
// DateRangePicker.tsx - Ø§Ù†ØªØ®Ø§Ø¨Ú¯Ø± Ø¨Ø§Ø²Ù‡ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
```

## ğŸ“Š UI/UX Design

### Layout Structure
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: ÙÛŒÙ„ØªØ±Ù‡Ø§ + Ø¬Ø³ØªØ¬Ùˆ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stats: Ù…Ø¬Ù…ÙˆØ¹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ + Ù…Ø¨Ù„Øº Ú©Ù„     â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” Actions      â”‚
â”‚ â”‚Card â”‚ â”‚Card â”‚ â”‚Card â”‚ Select All   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ Export      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” Bulk Send   â”‚
â”‚ â”‚Card â”‚ â”‚Card â”‚ â”‚Card â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pagination: Â« 1 2 3 ... 10 Â»        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Invoice Card Design
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜‘ï¸ #1211        ğŸŸ¢ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡       â”‚
â”‚ ğŸ‘¤ Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ÛŒÛŒ    ğŸ’° 125,000 ØªÙˆÙ…Ø§Ù†    â”‚  
â”‚ ğŸ“… 1404/07/20   ğŸ“ ØªÙ‡Ø±Ø§Ù†            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ“ ÙØ§Ú©ØªÙˆØ± Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡ Ø³Ø±ÙˆÛŒØ³ V2Ray      â”‚
â”‚ ğŸ”— Ø¬Ø²Ø¦ÛŒØ§Øª | ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ | âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Persian Calendar Integration

### Date Picker Component
- ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ native
- Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²Ù‡ ØªØ§Ø±ÛŒØ®
- Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§: Ø§Ù…Ø±ÙˆØ²ØŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ØŒ Ø§ÛŒÙ† Ù…Ø§Ù‡
- Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ø§Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ

## ğŸ“ˆ Performance Optimizations

### Backend Optimizations
- Database indexing Ø¨Ø± Ø±ÙˆÛŒ invoice dates
- Cursor-based pagination
- Query optimization Ø¨Ø§ prepared statements
- Caching Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø±Ù‡Ø§

### Frontend Optimizations  
- Virtual scrolling Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
- Lazy loading Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ú©ØªÙˆØ±
- Debounced search
- Memoized filter results

## ğŸ§ª Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØ³Øª

### Unit Tests
- Date filtering logic
- Search functionality
- Export functions
- Bulk operations

### Integration Tests
- Full workflow: filter â†’ select â†’ export
- API endpoint responses
- Persian calendar calculations

### User Experience Tests
- Mobile responsiveness
- Loading states
- Error handling
- Empty states

## âš¡ Implementation Roadmap

### Phase 5.3.1: Core History Page âœ… COMPLETE
1. âœ… InvoiceHistoryPage component created
2. âœ… API endpoints implemented (/api/invoices/history, /api/invoices/stats) 
3. âœ… Pagination setup with limit/offset
4. âœ… Navigation integration added to MainLayout
5. âœ… TypeScript interfaces and proper typing
6. âœ… Loading states and error handling
7. âœ… Export functionality (CSV/PDF)

### Phase 5.3.2: Filtering System (25 Ø¯Ù‚ÛŒÙ‚Ù‡)
1. DateRangePicker component
2. Filter form implementation
3. API integration
4. Real-time filtering

### Phase 5.3.3: Search & Actions (15 Ø¯Ù‚ÛŒÙ‚Ù‡)
1. Search functionality
2. Bulk selection
3. Export features
4. Final testing

**Total Estimated Time: 60 Ø¯Ù‚ÛŒÙ‚Ù‡**

---

## ğŸ¯ Success Criteria
- [ ] ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡
- [ ] ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®ÛŒ Ø´Ù…Ø³ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] ØµØ§Ø¯Ø±Ø§Øª Excel/PDF Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ø³Øª
- [ ] Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª
- [ ] ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª

**Ø´Ø±ÙˆØ¹ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ**: Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Phase 5.3.1